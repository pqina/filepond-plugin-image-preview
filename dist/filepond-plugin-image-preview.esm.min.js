/*
 * FilePondPluginImagePreview 2.0.0
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
const isPreviewableImage=e=>/^image/.test(e.type),transforms={1:()=>[1,0,0,1,0,0],2:e=>[-1,0,0,1,e,0],3:(e,t)=>[-1,0,0,-1,e,t],4:(e,t)=>[1,0,0,-1,0,t],5:()=>[0,1,1,0,0,0],6:(e,t)=>[0,1,-1,0,t,0],7:(e,t)=>[0,-1,-1,0,t,e],8:e=>[0,-1,1,0,0,e]},fixImageOrientation=(e,t,i,a)=>{-1!==a&&e.transform(...transforms[a](t,i))},createPreviewImage=(e,t,i,a)=>{t=Math.round(t),i=Math.round(i),a>=5&&a<=8&&([t,i]=[i,t]);const r=document.createElement("canvas"),o=r.getContext("2d");return a>=5&&a<=8?(r.width=i,r.height=t):(r.width=t,r.height=i),o.save(),fixImageOrientation(o,t,i,a),o.drawImage(e,0,0,t,i),o.restore(),"close"in e&&e.close(),r},isBitmap=e=>/^image/.test(e.type)&&!/svg/.test(e.type),IMAGE_SCALE_SPRING_PROPS={type:"spring",stiffness:.5,damping:.45,mass:10},createImageView=e=>e.utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,create:({root:e,props:t})=>{e.ref.clip=document.createElement("div"),e.element.appendChild(e.ref.clip);const i=e.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==i&&(e.element.dataset.transparencyIndicator="grid"===i?i:"color")},write:e.utils.createRoute({DID_IMAGE_PREVIEW_LOAD:({root:e,props:t,action:i})=>{const{id:a}=t,r=e.query("GET_ITEM",{id:t.id}),o=e.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR"),n=(r.getMetadata("exif")||{}).orientation||-1;let{width:s,height:c}=i.data;n>=5&&n<=8&&([s,c]=[c,s]);const d=r.getMetadata("crop")||{rect:{x:0,y:0,width:1,height:1},aspectRatio:c/s},l=window.devicePixelRatio,p=e.query("GET_IMAGE_PREVIEW_HEIGHT"),E=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),I=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),g=e.rect.inner.width,_=c/s,m=g,f=g*_,h=null!==p?p:Math.max(E,Math.min(c,I)),u=h/_,w=isBitmap(r.file)?createPreviewImage(i.data,u*l,h*l,n):i.data;let R=null!==p?p:Math.max(E,Math.min(g*d.aspectRatio,I)),y=R/d.aspectRatio;y>m&&(R=(y=m)*d.aspectRatio);const M=R/(f*d.rect.height);s=m*M,c=f*M;const T=-d.rect.x*m*M,v=-d.rect.y*f*M;e.ref.clip.style.cssText=`\n                    width: ${Math.round(y)}px;\n                    height: ${Math.round(R)}px;\n                `,w.style.cssText=`\n                    ${null!==o&&"grid"!==o?"background-color: "+o+";":""}\n                    width: ${Math.round(s)}px;\n                    height: ${Math.round(c)}px;\n                    transform: translate(${Math.round(T)}px, ${Math.round(v)}px) rotateZ(0.00001deg);\n                `,e.ref.clip.appendChild(w),e.dispatch("DID_IMAGE_PREVIEW_DRAW",{id:a})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:IMAGE_SCALE_SPRING_PROPS,scaleY:IMAGE_SCALE_SPRING_PROPS,opacity:{type:"tween",duration:750}}}}),definitions="<radialGradient id=\"filepond--image-preview-radial-gradient\" cx=\".5\" cy=\"1.25\" r=\"1.15\">\n<stop offset='50%' stop-color='#000000'/>\n<stop offset='56%' stop-color='#0a0a0a'/>\n<stop offset='63%' stop-color='#262626'/>\n<stop offset='69%' stop-color='#4f4f4f'/>\n<stop offset='75%' stop-color='#808080'/>\n<stop offset='81%' stop-color='#b1b1b1'/>\n<stop offset='88%' stop-color='#dadada'/>\n<stop offset='94%' stop-color='#f6f6f6'/>\n<stop offset='100%' stop-color='#ffffff'/>\n</radialGradient>\n\n<mask id=\"filepond--image-preview-masking\">\n<rect x=\"0\" y=\"0\" width=\"500\" height=\"200\" fill=\"url(#filepond--image-preview-radial-gradient)\"></rect>\n</mask>",appendDefinitions=()=>{if("interactive"===document.readyState){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.cssText="position:absolute;width:0;height:0",e.innerHTML=definitions,document.body.appendChild(e)}},hasNavigator="undefined"!=typeof navigator;hasNavigator&&(appendDefinitions(),document.addEventListener("readystatechange",appendDefinitions));const isEdgeOrIE=!!hasNavigator&&(document.documentMode||/Edge/.test(navigator.userAgent)),createImageOverlayView=e=>e.utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:({root:e,props:t})=>{e.element.classList.add(`filepond--image-preview-overlay-${t.status}`),e.element.innerHTML=`<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n                ${isEdgeOrIE?`<defs>${definitions}</defs>`:""}\n                <rect x="0" width="500" height="200" fill="currentColor" mask="url(#filepond--image-preview-masking)"></rect>\n            </svg>\n            `},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),BitmapWorker=function(){self.onmessage=(t=>{e(t.data.message,e=>{self.postMessage({id:t.data.id,message:e},[e])})});const e=(e,t)=>{fetch(e.file).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>t(e))}},getImageSize=(e,t)=>{let i=new Image;i.onload=(()=>{const e=i.naturalWidth,a=i.naturalHeight;i=null,t(e,a)}),i.src=e},canCreateImageBitmap=e=>"createImageBitmap"in window&&isBitmap(e),createImageWrapperView=e=>{const t=createImageOverlayView(e),i=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},a=({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlayError.opacity=1};return e.utils.createView({name:"image-preview-wrapper",create:({root:i,props:a})=>{const r=createImageView(e);i.ref.image=i.appendChildView(i.createChildView(r,{id:a.id,scaleX:1.25,scaleY:1.25,opacity:0})),i.ref.overlayShadow=i.appendChildView(i.createChildView(t,{opacity:0,status:"idle"})),i.ref.overlaySuccess=i.appendChildView(i.createChildView(t,{opacity:0,status:"success"})),i.ref.overlayError=i.appendChildView(i.createChildView(t,{opacity:0,status:"failure"}))},write:e.utils.createRoute({DID_IMAGE_PREVIEW_LOAD:({root:e})=>{e.ref.overlayShadow.opacity=1},DID_IMAGE_PREVIEW_DRAW:({root:e})=>{const{image:t}=e.ref;t.scaleX=1,t.scaleY=1,t.opacity=1},DID_IMAGE_PREVIEW_CONTAINER_CREATE:({root:t,props:i})=>{const{utils:a}=e,{createWorker:r,loadImage:o}=a,{id:n}=i,s=t.query("GET_ITEM",n),c=URL.createObjectURL(s.file),d=(e,t,i,a)=>{o(c).then(l)},l=e=>{URL.revokeObjectURL(c),t.dispatch("DID_IMAGE_PREVIEW_LOAD",{id:n,data:e})};getImageSize(c,(e,i)=>{if(t.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:n,width:e,height:i}),canCreateImageBitmap(s.file)){const e=r(BitmapWorker);e.post({file:c},t=>{e.terminate(),t?l(t):d()})}else d()})},DID_THROW_ITEM_LOAD_ERROR:a,DID_THROW_ITEM_PROCESSING_ERROR:a,DID_THROW_ITEM_INVALID:a,DID_COMPLETE_ITEM_PROCESSING:({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:i,DID_REVERT_ITEM_PROCESSING:i})})};var plugin$1=e=>{const{addFilter:t,utils:i}=e,{Type:a,createRoute:r,isFile:o}=i,n=createImageWrapperView(e);return t("CREATE_VIEW",e=>{const{is:t,view:i,query:a}=e;if(!t("file")||!a("GET_ALLOW_IMAGE_PREVIEW"))return;i.registerWriter(r({DID_LOAD_ITEM:({root:e,props:t,actions:r})=>{const{id:s}=t,c=a("GET_ITEM",s);if(!c||!o(c.file))return;const d=c.file;if(!isPreviewableImage(d))return;const l="createImageBitmap"in(window||{}),p=a("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");!l&&p&&d.size>p||(e.ref.imagePreview=i.appendChildView(i.createChildView(n,{id:s})),e.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:s}))},DID_IMAGE_PREVIEW_CALCULATE_SIZE:({root:e,props:t,action:i})=>{const a=e.query("GET_ITEM",{id:t.id}),r=(a.getMetadata("exif")||{}).orientation||-1;let{width:o,height:n}=i;r>=5&&r<=8&&([o,n]=[n,o]);const s=a.getMetadata("crop")||{rect:{x:0,y:0,width:1,height:1},aspectRatio:n/o},c=e.query("GET_IMAGE_PREVIEW_HEIGHT"),d=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),l=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT");if(!isBitmap(a.file)){const e=2048/o;o*=e,n*=e}(o=(n=null!==c?c:Math.max(d,Math.min(n,l)))/s.aspectRatio)>e.rect.element.width&&(n=(o=e.rect.element.width)*s.aspectRatio),e.ref.imagePreview.element.style.cssText=`height:${Math.round(n)}px`}}))}),{options:{allowImagePreview:[!0,a.BOOLEAN],imagePreviewHeight:[null,a.INT],imagePreviewMinHeight:[44,a.INT],imagePreviewMaxHeight:[256,a.INT],imagePreviewMaxFileSize:[null,a.INT],imagePreviewTransparencyIndicator:[null,a.STRING]}}};"undefined"!=typeof navigator&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:plugin$1}));export default plugin$1;